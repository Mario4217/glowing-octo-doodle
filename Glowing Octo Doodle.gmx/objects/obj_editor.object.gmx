<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>zoom = 1;
tzoom = 1;
drag = false;
drag_x = 0;
drag_y = 0;
x = room_width / 2;
y = room_height / 2;

place_x = 0;
place_y = 0;

interface[? "editor_menu"] = "0";
interface[? "editor_error"] = "";

editor_container = ui_create_container(0,0,1,1);
topbar = ui_add_child(editor_container, ui_create_label(0,0,1,0.05,""));
ui_set_event(topbar,"onchange","set editor_menu !value");

menu_is_open = 0;
menu_container = ui_add_child(editor_container, ui_create_label(-0.3,0.05,-0.1,1,""));
btn_save = ui_add_child(menu_container, ui_create_button(0,0.1,1,0.15,"{editor.save}","editor_save"));
btn_exit = ui_add_child(menu_container, ui_create_button(0,0.9,1,0.95,"{editor.exit}","editor_exit"));
btn_exit[? "gp_port"] = -1;

rad_t1 = ui_add_child(topbar, ui_create_radio(0,0,0.2,1,"{editor.map}",1));
rad_t2 = ui_add_child(topbar, ui_create_radio(0.2,0,0.4,1,"{editor.objects}",2));
rad_t3 = ui_add_child(topbar, ui_create_radio(0.4,0,0.6,1,"{editor.tiles}",3));
rad_t4 = ui_add_child(topbar, ui_create_button(0.9,0,1,1,"{editor.test}","editor_test"));
rad_t1[? "gp_right"] = rad_t2;
rad_t2[? "gp_right"] = rad_t3;
rad_t3[? "gp_right"] = rad_t4;
rad_t4[? "gp_right"] = rad_t1;
rad_t1[? "gp_left"] = rad_t4;
rad_t2[? "gp_left"] = rad_t1;
rad_t3[? "gp_left"] = rad_t2;
rad_t4[? "gp_left"] = rad_t3;

ui_gamepad_position = rad_t1;

objects_container = ui_create_label(0.8,0.05,1,1,"{editor.objects}");
tiles_container = ui_create_label(0.8,0.05,1,1,"{editor.tiles}");
maps_container = ui_create_label(0.7,0.05,1,1,"{editor.map}");

ui_set_value(objects_container,-1);

ui_set_class(objects_container,"editor-panel");
ui_set_class(tiles_container,"editor-panel");
ui_set_class(maps_container,"editor-panel");

ui_add_child(editor_container, objects_container);
ui_add_child(editor_container, tiles_container);
ui_add_child(editor_container, maps_container);

ui_add_child(maps_container, ui_create_label(0,0.1,1,0.15,"{editor.map.name}"));
input_name = ui_add_child(maps_container, ui_create_textbox(0,0.15,1,0.2,64,"",false));
input_width = ui_add_child(maps_container, ui_create_slider(0,0.2,1,0.25,"{editor.map.width}",32,512,32));
input_height = ui_add_child(maps_container, ui_create_slider(0,0.25,1,0.3,"{editor.map.height}",32,512,32));
input_players = ui_add_child(maps_container, ui_create_slider(0,0.3,1,0.35,"{editor.map.players}",1,16,1));
ui_set_event(input_name,"onchange","editor_update");
ui_set_event(input_width,"onchange","editor_update");
ui_set_event(input_height,"onchange","editor_update");
ui_set_event(input_players,"onchange","editor_update");

error = ui_create_button(0.3,0.3,0.7,0.7,"",'set editor_error ""');
ui_set_class(error, "editor-error");
ui_add_child(editor_container, error);

//entity stat/setting panel
ent_label = ui_create_draggable(0.7,0.7,1,1,"{editor.selected_entity}",true);
ent_label[? "visible"] = false;
ui_set_class(ent_label, "editor-panel");
//ent_label_type = ui_add_child(ent_label, ui_create_label(0,0.15,1,0.25,""));
ui_add_child(ent_label,ui_create_button(0,0.9,1,1,"{editor.entity.destroy}","editor_destroy"));
ent_label_attributes = ui_create_label(0,0.15,1,0.9,"");
ui_add_child(ent_label, ent_label_attributes);
ui_add_child(editor_container, ent_label);

world_width = 64;
world_height = 64;
world_name = "unnamed";
world_players = 1;

ui_set_value(input_name, world_name);
ui_set_value(input_width, world_width);
ui_set_value(input_height, world_height);
ui_set_value(input_players, world_players);

for (var i=0; i&lt;ds_list_size(gp_editor); i++){
  var map = gp_objects[? gp_editor[| i]];
  var u = (i % 2) * 0.5;
  var v = floor(i/2)*0.1+0.1;
  var btn = ui_create_radio(u,v,u+0.5,v+0.1,""/*map[? "name"]*/,map[? "id"]);
  ui_add_child(btn,ui_create_sprite(0.01,0.01,0.99,0.99,map[? "sprite"],0));
  ui_add_child(objects_container,btn);
}

if (global.toLoad != ""){
  world_load(global.toLoad);
  global.toLoad = "";
}

rad_t1[? "gp_port"] = ds_list_find_value(maps_container[? "children"],1);
rad_t2[? "gp_port"] = ds_list_find_value(objects_container[? "children"],0);
rad_t3[? "gp_port"] = ds_list_find_value(tiles_container[? "children"],0);

inst_selected = -1;
testmode = "";
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>show_grid = false;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>view_wview[0] = view_wport[0] / zoom;
view_hview[0] = view_hport[0] / zoom;

if ((mouse_wheel_up() || gamepad_button_check_pressed(0,gp_shoulderrb)) &amp;&amp; tzoom &lt; 16){
  tzoom *= 2;
}
if ((mouse_wheel_down() || gamepad_button_check_pressed(0,gp_shoulderlb)) &amp;&amp; tzoom &gt; 0.25){
  tzoom /= 2;
}
zoom += (tzoom-zoom)/4;

x = clamp(x+gamepad_axis_value(0,gp_axisrh)*10/zoom,0,world_width*32);
y = clamp(y+gamepad_axis_value(0,gp_axisrv)*10/zoom,0,world_height*32);

if (mouse_check_button_pressed(mb_middle)){
  drag = true;
  drag_x = mouse_x + view_wview[0] / 2;
  drag_y = mouse_y + view_hview[0] / 2;
}
if (drag){
  x = round(clamp(drag_x - (mouse_x - view_xview[0]),0,world_width*32));
  y = round(clamp(drag_y - (mouse_y - view_yview[0]),0,world_height*32));
  if (mouse_check_button_released(mb_middle)){
    drag = false;
  }
}

view_xview[0] = x - view_wview[0]/2;
view_yview[0] = y - view_hview[0]/2;

ui_set_position(menu_container,ui_interpolate(1,menu_container[? "u1"], -0.3+menu_is_open*0.3, 0.3),0.05);
ui_set_position(maps_container,ui_interpolate(1,maps_container[? "u1"], 1-real(interface[? "editor_menu"] == "1")*0.3, 0.3),0.05);
ui_set_position(objects_container,ui_interpolate(1,objects_container[? "u1"], 1-real(interface[? "editor_menu"] == "2")*0.2, 0.3),0.05);
ui_set_position(tiles_container,ui_interpolate(1,tiles_container[? "u1"], 1-real(interface[? "editor_menu"] == "3")*0.2, 0.3),0.05);

if (bind_check_pressed("menu")){
  if (menu_is_open == 0){
    menu_is_open = 1;
    ui_gamepad_position = btn_save;
  }else{
    menu_is_open = 0;
    ui_gamepad_position = rad_t1;
  }
  inst_selected = -1;
}
if (gamepad_button_check_pressed(0,gp_face2)){
  if (interface[? "editor_menu"] != 0){
    if (interface[? "editor_menu"] == "2"){
      ui_gamepad_position = rad_t2; 
    }else if (interface[? "editor_menu"] == "3"){
      ui_gamepad_position = rad_t3;
    }else{
      ui_gamepad_position = rad_t1;
    }
    interface[? "editor_menu"] = 0;
    ui_set_value(topbar, 0);
  }
}

if (interface[? "editor_error"] != ""){
  error[? "visible"] = true;
  error[? "text"] = interface[? "editor_error"];
}else{
  error[? "visible"] = false;
}

if (interface[? "editor_menu"] == "2"){
  var obj_to_place = ui_get_value(objects_container);
  if (obj_to_place != -1){
    if (mouse_check_button_pressed(mb_right)){
      ui_set_value(objects_container, -1);
    }
  }
}

ent_label[? "visible"] = (inst_selected != -1);
if (instance_exists(inst_selected) &amp;&amp; inst_selected != -1){
  var map = gp_objects[? inst_selected.gp_obj_index];
  if (map != undefined){  
    //ui_set_text(ent_label_type, lang_format("{editor.entity.type}", map[? "name"]));
  }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="5">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>ds_map_destroy(editor_container);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_set_font(ft_ui);
ui_draw(editor_container);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_set_color(c_red);
draw_rectangle(0,0,world_width*32, world_height * 32, true);

if (interface[? "editor_menu"] == "2"){
  var obj_to_place = ui_get_value(objects_container);
  if (obj_to_place != -1){
    show_grid = true;
    var map = gp_objects[? obj_to_place];
    if (ui_mouse_moved){
      place_x = mouse_x;
      place_y = mouse_y;
    }
    place_x += gamepad_axis_value(0, gp_axislh);
    place_y += gamepad_axis_value(0, gp_axisrh);
    if (!keyboard_check(vk_alt)){
      place_x = round(place_x/16)*16;
      place_y = round(place_y/16)*16;
    }
    var w = sprite_get_width(map[? "sprite"]);
    var h = sprite_get_width(map[? "sprite"]);
    var ox = sprite_get_xoffset(map[? "sprite"]);
    var oy = sprite_get_yoffset(map[? "sprite"]);
    var c = (ui_hover != -1)//collision_rectangle(place_x-ox, place_y-oy, place_x+w-ox, place_y+h-oy,obj_editor_ent,0,0);
    if (c){
      var color = c_red;
    }else{
      var color = c_lime;
    }
    draw_sprite_ext(map[? "sprite"], 0, place_x, place_y,1,1,0,color,0.3);
    if ((mouse_check_button_pressed(mb_left) || gamepad_button_check_pressed(0, gp_face1)) &amp;&amp; !c){
      var inst = instance_create(place_x,place_y,obj_editor_ent);
      inst.gp_obj_index = obj_to_place;
      ui_set_value(objects_container, -1);
    }
  }
}

if (inst_selected != -1){
  draw_set_color(c_red);
  draw_rectangle(inst_selected.bbox_left-2, inst_selected.bbox_top-2, inst_selected.bbox_right+1, inst_selected.bbox_bottom+1, true);
}
if (instance_exists(ui_hover)){
  if (ui_hover.object_index == obj_editor_ent){
    draw_set_color(c_lime);
    draw_rectangle(ui_hover.bbox_left-3, ui_hover.bbox_top-3, ui_hover.bbox_right+2, ui_hover.bbox_bottom+2, true);
  }
}

if (show_grid){
  draw_set_color(c_black);
  for (var i=max(floor(view_xview[0]/32),1); i&lt;min(ceil((view_wview[0]+view_xview[0])/32),world_width); i+=1)
  {
    draw_set_color(c_black)
    if ((i mod 4)==0){draw_set_color(c_blue)}
    if ((i mod 16)==0){draw_set_color(c_lime)}
    draw_line(i*32-1,0,i*32-1,world_height*32);
  };
  for (var i=max(floor(view_yview[0]/32),1); i&lt;min(ceil((view_hview[0]+view_yview[0])/32),world_height); i+=1)
  {
    draw_set_color(c_black)
    if ((i mod 4)==0){draw_set_color(c_blue)}
    if ((i mod 16)==0){draw_set_color(c_lime)}
    draw_line(0,i*32-1,world_width*32,i*32-1);
  };
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
